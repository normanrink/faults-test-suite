cmake_minimum_required(VERSION 2.8)

# Require LLVM with builtins/intrinsics for encoding:
find_package(LLVM REQUIRED CONFIG)
message(STATUS "Found LLVM ${LLVM_PACKAGE_VERSION}")
message(STATUS "Using LLVMConfig.cmake in: ${LLVM_DIR}")

# Define short-hands for a couple of LLVM's binaries:
set(CLANG     ${LLVM_INSTALL_PREFIX}/bin/clang)
set(CLANGXX   ${LLVM_INSTALL_PREFIX}/bin/clang++)
set(LLVM_LINK ${LLVM_INSTALL_PREFIX}/bin/llvm-link)
set(LLVM_DIS  ${LLVM_INSTALL_PREFIX}/bin/llvm-dis)
set(OPT       ${LLVM_INSTALL_PREFIX}/bin/opt)

# 'objdump' for disassembling binaries:
set(OBJDUMP   objdump)

# Use 'clang' as the standard compiler:
set(CMAKE_C_COMPILER ${CLANG})
set(CMAKE_CXX_COMPILER ${CLANGXX})

# Variables for the configuration of test suites:
set(PIN_COMMAND  "" CACHE PATH "path to executable PIN tool")
set(BFI_SO_PATH  "" CACHE PATH "path to BFI plug-in for the PIN tool")
set(SUITE_FOLDER "" CACHE PATH "folder for output generated by tests")
set(WARM_UP_RUNS "10"  CACHE STRING "")
set(FI_RUNS      "100" CACHE STRING "")
set(VERI_RUNS    "1"   CACHE STRING "")

# Variables for building the test cases:
set(ENCODER           "" CACHE PATH "")

# Variables for configuring the test cases:
set(LENGTH      "1" CACHE STRING "")
set(REPETITIONS "1" CACHE STRING "")

# Library of functions common to all test cases:
add_subdirectory(utility)

add_subdirectory(transformations)
set(NO_ENC_INLINE_LIB
    ${CMAKE_CURRENT_BINARY_DIR}/transformations/libNoEncInline.so)

# Build the test cases:
add_subdirectory(tests)

# Generate configuration files for various test suites:
set(BINARIES_FOLDER ${CMAKE_CURRENT_BINARY_DIR}/tests)
add_subdirectory(configs)
